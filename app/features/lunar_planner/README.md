## üåô –õ—É–Ω–Ω—ã–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –¥–µ–ª

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
- –î–∞–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ¬´–≤–∏–¥ —Å–≤–µ—Ä—Ö—É¬ª –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ —Ñ–∞–∑—ã –õ—É–Ω—ã –∏ —Å—Ñ–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–æ–∏—Ç –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å.
- –†–∞–∑–¥–µ–ª—è—Ç—å –Ω–∞–±–æ—Ä –ø–æ–¥—Å–∫–∞–∑–æ–∫ –¥–ª—è free- –∏ premium-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–±–æ–ª—å—à–µ –¥–Ω–µ–π, –±–æ–ª—å—à–µ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤, –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞).
- –ü—Ä–µ–¥–ª–∞–≥–∞—Ç—å –±—ã—Å—Ç—Ä—ã–π –ø–µ—Ä–µ—Ö–æ–¥ –∫ –Ω—É–∂–Ω–æ–π —Å—Ñ–µ—Ä–µ —á–µ—Ä–µ–∑ inline-–∫–Ω–æ–ø–∫–∏ –∏ —Å—Ç–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∞–ø–≥—Ä–µ–π–¥ –¥–æ Premium.

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π
1. –ö–æ–º–∞–Ω–¥–∞ `/lunar_planner` (–∫–Ω–æ–ø–∫–∞ ¬´üåô –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫¬ª –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é) —Å—Ç—Ä–æ–∏—Ç –æ–∫–Ω–æ 4‚Äì6 –¥–Ω–µ–π –ø–æ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ç–∞–π–º–∑–æ–Ω–µ.
2. –í –æ—Ç–≤–µ—Ç–µ: —Ç–µ–∫—É—â–∞—è —Ñ–∞–∑–∞, –∑–Ω–∞–∫ –õ—É–Ω—ã, –∫—Ä–∞—Ç–∫–∏–π —Å–º—ã—Å–ª –∏ 3‚Äì5 –ª—É—á—à–∏—Ö –¥–µ–ª –Ω–∞ –¥–µ–Ω—å (–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∞—Ä–∏—Ñ–∞).
3. Inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–µ—Ä–µ—á–µ–Ω—å —Å—Ñ–µ—Ä (¬´üöÄ –°—Ç–∞—Ä—Ç –ø—Ä–æ–µ–∫—Ç–∞¬ª, ¬´üíû –û—Ç–Ω–æ—à–µ–Ω–∏—è¬ª –∏ —Ç.–¥.).
4. –ü–æ –Ω–∞–∂–∞—Ç–∏—é –Ω–∞ –∫–Ω–æ–ø–∫—É ‚Äî –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å ¬´–ª—É—á—à–∏–º–∏¬ª, ¬´–ø–æ–¥—Ö–æ–¥—è—â–∏–º–∏¬ª –∏ ¬´–Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–º–∏¬ª –¥–Ω—è–º–∏ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è.
5. –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –ø—Ä–æ–º–æ-CTA –Ω–∞ Premium, –ø—Ä–µ–º–∏—É–º-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º ‚Äî –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö.

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è
- `app/shared/astro/lunar_planner.py` ‚Äî `LunarPlannerService`:
  - –ë–µ—Ä—ë—Ç —ç—Ñ–µ–º–µ—Ä–∏–¥—ã `flatlib`, —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ñ–∞–∑—É/–∑–Ω–∞–∫ –õ—É–Ω—ã –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç `DayContext`.
  - –•—Ä–∞–Ω–∏—Ç –º–∞—Ç—Ä–∏—Ü—É —Å—Ñ–µ—Ä (`ActionDefinition`), —Ä–∞–∑–¥–µ–ª—è–µ—Ç free/premium –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.
- `app/features/lunar_planner/router.py` ‚Äî –∫–æ–º–∞–Ω–¥—ã –∏ callback-–∏:
  - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ–±–∑–æ—Ä–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É, –¥–µ—Ç–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç–æ—á–∫—É –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ñ–µ—Ä–µ.
  - –î–µ–ª–∞–µ—Ç –ø—Ä–æ–º–æ-–±–ª–æ–∫–∏ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏.
- `app/shared/keyboards/lunar_planner.py` ‚Äî inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å—Ñ–µ—Ä + –∫–Ω–æ–ø–∫–∞ ¬´‚Ü©Ô∏è –í –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é¬ª.
- `app/shared/messages.py` ‚Äî —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã (–∏–Ω—Ç—Ä–æ, –¥–µ—Ç–∞–ª–∏, CTA, –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏).
- `app/shared/keyboards/main.py` ‚Äî –∫–Ω–æ–ø–∫–∞ ¬´üåô –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫¬ª –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é.
- README –∏ –æ—Å–Ω–æ–≤–Ω–æ–π README –æ–±–Ω–æ–≤–ª–µ–Ω—ã –æ–ø–∏—Å–∞–Ω–∏–µ–º –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.

### Premium vs Free
- Free: 4 –¥–Ω—è, –¥–æ 3 –ø–æ–¥—Å–∫–∞–∑–æ–∫ –Ω–∞ –¥–µ–Ω—å, –¥–æ—Å—Ç—É–ø –∫ –±–∞–∑–æ–≤—ã–º —Å—Ü–µ–Ω–∞—Ä–∏—è–º.
- Premium: 6 –¥–Ω–µ–π, –¥–æ 5 –ø–æ–¥—Å–∫–∞–∑–æ–∫ –Ω–∞ –¥–µ–Ω—å, —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (—Å–ø–æ—Ä—Ç, –∞–Ω–∞–ª–∏—Ç–∏–∫–∞, –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è, —á–µ–∫–∞–ø—ã) –∏ –æ—Ç–¥–µ–ª–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫.

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–µ—Ç–∞–ª–∏
- –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–æ–Ω–∞ –±–µ—Ä—ë—Ç—Å—è –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è (`birth_profile_storage`) –∏–ª–∏ –∏–∑ `user_storage` (fallback `UTC`).
- –ï—Å–ª–∏ –∑–æ–Ω–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞/–±–∏—Ç–∞—è ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è UTC, —á—Ç–æ–±—ã —Ä–∞—Å—á—ë—Ç—ã –Ω–µ –ø–∞–¥–∞–ª–∏.
- –°–ø–∏—Å–æ–∫ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ –∏ –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å `ActionDefinition`.
- –ü–æ–¥–±–æ—Ä –ø–æ–¥—Å–∫–∞–∑–æ–∫ —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ –æ—Ü–µ–Ω–∫–µ —Ñ–∞–∑—ã (great/good/neutral/avoid) –∏ —Å–∫—Ä—ã–≤–∞–µ—Ç premium-only –ø—É–Ω–∫—Ç—ã –¥–ª—è free.

### –ü—Ä–æ–≤–µ—Ä–∫–∞
```
# –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É
/lunar_planner

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
# –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±—É—é –∫–Ω–æ–ø–∫—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´üöÄ –°—Ç–∞—Ä—Ç –ø—Ä–æ–µ–∫—Ç–∞¬ª).

# –†—É—á–Ω–æ–π —Ç–µ—Å—Ç —Å–µ—Ä–≤–∏—Å–∞
python - <<'PY'
from datetime import date
from app.shared.astro.lunar_planner import lunar_planner_service

window = lunar_planner_service.build_window(start=date.today(), tz_name="Europe/Moscow", days=6)
for ctx in window:
    actions = lunar_planner_service.select_actions(day=ctx, is_premium=True, limit=5)
    print(ctx.date, ctx.phase.key, [a.action.slug for a in actions])
PY
```

### TODO –Ω–∞ –±—É–¥—É—â–µ–µ
- –ü–æ–¥—Ç—è–≥–∏–≤–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–¥–æ–º–∞, –∞—Å–ø–µ–∫—Ç—ã) –¥–ª—è –æ—Ü–µ–Ω–∫–∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤.
- –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ–Ω–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ scheduler (–≤ —Ä–∞–º–∫–∞—Ö Premium PRO).
- –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è/–∞–Ω–≥–ª–∏–π—Å–∫–∞—è –≤–µ—Ä—Å–∏—è, –µ—Å–ª–∏ –±–æ—Ç –≤—ã–π–¥–µ—Ç –Ω–∞ –¥—Ä—É–≥–æ–π —Ä—ã–Ω–æ–∫.
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–π –ø–æ —Å—Ñ–µ—Ä–∞–º –≤ `user_storage`.


