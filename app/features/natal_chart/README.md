## üåå –ù–∞—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞ –¥–Ω—è

### –ö—Ä–∞—Ç–∫–æ

- **–ö–æ–º–∞–Ω–¥–∞ / –∫–Ω–æ–ø–∫–∞:** `/natal_chart` –∏–ª–∏ ¬´üåå –ù–∞—Ç–∞–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∞¬ª –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é.
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ø–æ–∫–∞–∑–∞—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—É—é –Ω–∞—Ç–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≤—ã–¥–µ–ª–∏—Ç—å –∫–ª—é—á–µ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∏—Ç–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã –∏ –¥–∞—Ç—å –∫—Ä–∞—Ç–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏.
- **–î–æ—Å—Ç—É–ø:**
  - Free ‚Äî –ø—Ä–µ–≤—å—é (–ø–µ—Ä–≤—ã–π –∞—Å–ø–µ–∫—Ç + –ø—Ä–æ–º–æ-–±–ª–æ–∫).
  - Premium ‚Äî –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç (–¥–æ 6 –∞—Å–ø–µ–∫—Ç–æ–≤) + –∞–≤—Ç–æ—Ä–∞—Å—Å—ã–ª–∫–∞.

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- `flatlib` + `pyswisseph` ‚Äî –ø–æ–∑–∏—Ü–∏–∏ –ø–ª–∞–Ω–µ—Ç, –∞—Å–ø–µ–∫—Ç—ã, –¥–æ–º–∞.
- `tzdata` ‚Äî —Ä–∞–±–æ—Ç–∞ `ZoneInfo` –Ω–∞ Windows.
- –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏ `app/shared/astro/*`.

### –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ—Ö–æ–¥–∏—Ç `/natal_profile`.
2. –í `birth_profiles.json` —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –¥–∞—Ç–∞, –≤—Ä–µ–º—è, `timezone`, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã, `last_forecast_sent`.
3. –°—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏ –±–µ—Ä—ë—Ç—Å—è –∏–∑ `user_storage`.

### –û–±—Ä–∞–±–æ—Ç–∫–∞

1. `DailyTransitService.generate(...)`
   - —Å—Ç—Ä–æ–∏—Ç –Ω–∞—Ç–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É (—Ç–∞–±–ª–∏—Ü–∞ –¥–æ–º–æ–≤ + –ø–ª–∞–Ω–µ—Ç—ã);
   - —Å—Ç—Ä–æ–∏—Ç —Ç—Ä–∞–Ω–∑–∏—Ç–Ω—É—é –∫–∞—Ä—Ç—É –Ω–∞ —Ü–µ–ª–µ–≤—É—é –¥–∞—Ç—É;
   - –Ω–∞—Ö–æ–¥–∏—Ç –∞—Å–ø–µ–∫—Ç—ã (`find_transit_aspects`).
2. `TransitInterpreter.render_forecast(...)`
   - –ø–æ–¥–±–∏—Ä–∞–µ—Ç —à–∞–±–ª–æ–Ω—ã –∏–∑ `data/transit_templates.json`;
   - –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞–º–µ—Ç–∫–∏ –ø–æ —Ç—Ä–∞–Ω–∑–∏—Ç–Ω–æ–º—É/–Ω–∞—Ç–∞–ª—å–Ω–æ–º—É –¥–æ–º—É;
   - —Å–æ–±–∏—Ä–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ + —Ç–µ–∫—Å—Ç + —Å–æ–≤–µ—Ç.

### –†–∞—Å—Å—ã–ª–∫–∞ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

- `NotificationScheduler._send_daily_transit_forecasts` (–∫–∞–∂–¥–∞—è –º–∏–Ω—É—Ç–∞):
  - –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π `ZoneInfo` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è;
  - –µ—Å–ª–∏ 11:00 –ª–æ–∫–∞–ª—å–Ω–æ –∏ –∫–∞—Ä—Ç–∞ –µ—â—ë –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª–∞—Å—å ‚Äî —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ;
  - Premium ‚Üí –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç; Free ‚Üí –ø—Ä–µ–≤—å—é + –ø—Ä–æ–º–æ;
  - –æ—Ç–º–µ—á–∞–µ—Ç `last_forecast_sent` –≤ `birth_profiles`.

### –•—Ä–∞–Ω–∏–ª–∏—â–µ –∏ –∫–µ—à–∏

- `birth_profiles.json` ‚Äî –ø—Ä–æ—Ñ–∏–ª—å + –æ—Ç–º–µ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏.
- `users_data.json` ‚Äî —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∫–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.
- –®–∞–±–ª–æ–Ω—ã: `data/transit_templates.json` (–∞—Å–ø–µ–∫—Ç—ã + –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–º–æ–≤).

### –í–∞–∂–Ω—ã–µ —Ñ–∞–π–ª—ã

- `app/features/natal_chart/router.py`
- `app/shared/astro/ephemeris.py`
- `app/shared/astro/transits.py`
- `app/shared/astro/daily_transits.py`
- `app/shared/astro/interpretation.py`
- `app/scheduler.py` (–º–µ—Ç–æ–¥ `_send_daily_transit_forecasts`).

### –ü—Ä–æ–≤–µ—Ä–∫–∞

```
# –∑–∞–ø–æ–ª–Ω–∏—Ç—å –Ω–∞—Ç–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
/natal_profile

# –∑–∞–ø—Ä–æ—Å–∏—Ç—å –∫–∞—Ä—Ç—É –≤—Ä—É—á–Ω—É—é
/natal_chart

# –≤—Ä—É—á–Ω—É—é –ø—Ä–æ–≥–Ω–∞—Ç—å —Å–µ—Ä–≤–∏—Å
from app.shared.astro import daily_transit_service
forecast = daily_transit_service.generate_for_user(user_id)

# –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —á–µ—Ä–µ–∑ scheduler
await NotificationScheduler(bot)._send_daily_transit_forecasts(datetime.utcnow())
```

### –í–æ–ø—Ä–æ—Å—ã —Ä–∞–∑–≤–∏—Ç–∏—è

- –†–∞—Å—à–∏—Ä–∏—Ç—å —à–∞–±–ª–æ–Ω—ã –∞—Å–ø–µ–∫—Ç–æ–≤ / –¥–æ–º–æ–≤.
- –î–æ–±–∞–≤–∏—Ç—å –≤—ã–±–æ—Ä –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∞—Å–ø–µ–∫—Ç–æ–≤ –¥–ª—è Premium.
- –•—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∫–∞—Ä—Ç —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ –ø–æ –¥–∞—Ç–∞–º.
